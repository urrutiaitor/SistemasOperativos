package copiadorArchivos;

import java.io.File;
import java.util.concurrent.Callable;
import java.util.concurrent.CompletionService;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.ExecutorCompletionService;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;



public class CopyCompletionService {
	
		int numHilos;
		
		ExecutorService executor;
		CompletionService<String> copyService;
		
		
		public CopyCompletionService(int numHilos){
			this.numHilos = numHilos;
			executor = Executors.newFixedThreadPool(numHilos);
			copyService = new ExecutorCompletionService<String>(executor);
			
		}
		
		public boolean copiarFicheros(File directorio, String path){
			if (!directorio.isDirectory()){
				return false;
			}
			File [] ficheros;
			int ficherosACopiar = 0;
			ficheros = directorio.listFiles();
			for (int i = 0; i<ficheros.length;i++){
				if (ficheros[i].isFile()){
					Copiador copiador = new Copiador(ficheros[i],path);
					ficherosACopiar++;
					copyService.submit(copiador);
				}
			}
			
			
			for (int i=0; i<ficherosACopiar; i++){
				String nombre;
				Future<String> future;
				try {
					future = copyService.take();
					nombre = future.get();
					System.out.println(nombre +" copiado");
					
				} catch (InterruptedException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (ExecutionException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				
			}
			executor.shutdown();
			return true;
		}
		
		public static void main(String[] args) {
			File file = new File ("E:\\Mis documentos\\Mi m�sica\\Int�rprete desconocido");
			String path = "E:\\copia";
			CopyCompletionService ejercicio = new CopyCompletionService(4);
			
			if (!ejercicio.copiarFicheros(file,path)){
				System.out.println("Debes introducir un directorio");
			}
			
		}
		
		
}
