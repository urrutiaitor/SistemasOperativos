package itv;

import java.util.concurrent.Semaphore;

public class Aparcamiento {

	int numCochesParking;
	int numCochesInspeccion;
	
	int numCochesMaximo;
	int numInspeccionesMaximo;
	
	Semaphore semaforoAparcamiento;
	Semaphore semaforoInspeccion;
	
	Semaphore candadoAparcamiento;
	Semaphore candadoOperario;
	
	public Aparcamiento(int numCochesParking, int numCochesInspeccion, int numCochesMaximo, int numInspeccionesMaximo) {
		super();
		this.numCochesParking = numCochesParking;
		this.numCochesInspeccion = numCochesInspeccion;
		this.numCochesMaximo = numCochesMaximo;
		this.numInspeccionesMaximo = numInspeccionesMaximo;
		
		semaforoAparcamiento = new Semaphore(numCochesMaximo);
		semaforoInspeccion = new Semaphore(numInspeccionesMaximo);
		
		candadoAparcamiento = new Semaphore(1);
		candadoOperario = new Semaphore(0);
	}

	public void inspeccionarCoche() throws InterruptedException{
		candadoOperario.acquire();
		candadoAparcamiento.acquire();
		if(numCochesParking > 0){
			numCochesParking--;
			if(numCochesParking > 0) candadoOperario.release();
			semaforoInspeccion.acquire();
			semaforoAparcamiento.release();
			System.out.println("Inspeccionando coche");
			semaforoInspeccion.release();
		}
	}
	
	public void aparcarCoche() throws InterruptedException{
		System.out.println("A aparcar coche");
		if(semaforoAparcamiento.tryAcquire()){
			System.out.println("Coche aparcao");
			candadoAparcamiento.acquire();
			numCochesParking++;
			candadoAparcamiento.release();
			if(numCochesParking == 1) candadoOperario.release();
		} else {
			return;
		}
	}
}
